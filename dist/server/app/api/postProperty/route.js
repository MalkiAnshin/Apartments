"use strict";(()=>{var e={};e.id=138,e.ids=[138],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},92624:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>$});var s={};t.r(s),t.d(s,{POST:()=>c});var o=t(49303),i=t(88716),a=t(60670),p=t(87070),n=t(92048),u=t(55315),l=t.n(u),d=t(68735);async function c(e){try{let r,t;let s=await e.formData(),o=s.get("city")?.trim().replace(/\s+/g," ")||"",i=s.get("neighborhood")?.trim().replace(/\s+/g," ")||"",a=s.get("price")?.trim()||"",u=s.get("rooms")?.trim()||"",c=s.get("propertyType")?.trim()||"",g=s.getAll("images"),m=g.map((e,r)=>`${r+1}.jpg`),$=s.get("userId")?.trim()||"",y="true"===s.get("hasBalcony"),h=parseInt(s.get("floor")?.trim()||"0",10),_=s.get("contactSeller")?.trim()||"",f=s.get("address")?.trim()||"",E="true"===s.get("elevator"),R="true"===s.get("warehouse"),v="true"===s.get("parking"),T="true"===s.get("isBuilt"),b=parseInt(s.get("buildableArea")?.trim()||"0",10),N=s.get("businessType")?.trim()||"",S=s.get("monthlyYield")?.trim()||"",w=s.get("size")?.trim()||"",P=await d.Z.connect(),I=`{${m.join(",")}}`;if("Apartment"===c)r=`
        INSERT INTO apartments (city, neighborhood, price, rooms, image_paths, user_id, has_balcony, floor, contact_seller, address, elevator, warehouse, parking)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13)
        RETURNING property_id`,t=[o,i,a,u,I,$,y,h,_,f,E,R,v];else if("Project"===c)r=`
        INSERT INTO projects (city, neighborhood, price, rooms, image_paths, is_built)
        VALUES ($1, $2, $3, $4, $5, $6)
        RETURNING property_id`,t=[o,i,a,u,I,T];else if("Land"===c)r=`
        INSERT INTO lands (city, neighborhood, price, size, buildable_area, user_id, address, contact_info)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
        RETURNING property_id`,t=[o,i,a,w,b,$,f,_];else if("Business"===c)r=`
        INSERT INTO business (city, neighborhood, price, size, business_type, monthly_yield, user_id, address, contact_info, image_paths)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
        RETURNING property_id`,t=[o,i,a,w,N,S,$,f,_,I];else throw Error("Invalid property type");let x=(await P.query(r,t)).rows[0].property_id,A=`
      UPDATE users
      SET first_listing_free = TRUE
      WHERE identity_number = $1`;await P.query(A,[$]),P.release();let U=l().join(process.cwd(),"public","pictures",c,x.toString());await n.promises.mkdir(U,{recursive:!0});for(let e=0;e<g.length;e++){let r=g[e],t=Buffer.from(await r.arrayBuffer()),s=l().join(U,`${e+1}.jpg`);await n.promises.writeFile(s,t)}return p.NextResponse.json({message:"Property added successfully!",propertyId:x})}catch(e){return console.error("Error saving property:",e),p.NextResponse.json({error:"Error saving property"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/postProperty/route",pathname:"/api/postProperty",filename:"route",bundlePath:"app/api/postProperty/route"},resolvedPagePath:"C:\\Users\\Malki\\OneDrive\\שולחן העבודה\\פרויקט מאגר דירות\\Apartments\\app\\api\\postProperty\\route.tsx",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:$,serverHooks:y}=g,h="/api/postProperty/route";function _(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:$})}},68735:(e,r,t)=>{t.d(r,{Z:()=>o});let{Pool:s}=t(35900),o=new s({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:process.env.DB_PORT,ssl:!1})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972],()=>t(92624));module.exports=s})();