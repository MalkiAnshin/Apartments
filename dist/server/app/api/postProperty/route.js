"use strict";(()=>{var e={};e.id=138,e.ids=[138],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},92624:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>E,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>$,staticGenerationAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{POST:()=>d});var s=t(49303),i=t(88716),p=t(60670),a=t(87070),n=t(92048),u=t(55315),c=t.n(u),l=t(68735);async function d(e){try{let r,t;let o=await e.formData(),s=o.get("city").trim().replace(/\s+/g," "),i=o.get("neighborhood").trim().replace(/\s+/g," "),p=o.get("price").trim(),u=o.get("rooms").trim(),d=o.get("propertyType").trim(),g=o.getAll("images"),m=g.map((e,r)=>`${r+1}.jpg`),y=o.get("userId").trim(),$="true"===o.get("hasBalcony"),h=parseInt(o.get("floor").trim(),10),E=o.get("contactSeller").trim(),f=o.get("address").trim(),R="true"===o.get("elevator"),v="true"===o.get("warehouse"),_="true"===o.get("parking"),T=await l.Z.connect(),N=`{${m.join(",")}}`;if("Apartment"===d)r=`
        INSERT INTO apartments (city, neighborhood, price, rooms, image_paths, user_id, has_balcony, floor, contact_seller, address, elevator, warehouse, parking)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13)
        RETURNING property_id`,t=[s,i,p,u,N,y,$,h,E,f,R,v,_];else if("Project"===d)r=`
        INSERT INTO projects (city, neighborhood, price, rooms, image_paths)
        VALUES ($1, $2, $3, $4, $5)
        RETURNING property_id`,t=[s,i,p,u,N];else if("Land"===d)r=`
        INSERT INTO lands (city, neighborhood, price, rooms, image_paths)
        VALUES ($1, $2, $3, $4, $5)
        RETURNING property_id`,t=[s,i,p,u,N];else if("Business"===d)r=`
        INSERT INTO business (city, neighborhood, price, rooms, image_paths)
        VALUES ($1, $2, $3, $4, $5)
        RETURNING property_id`,t=[s,i,p,u,N];else throw Error("Invalid property type");let S=(await T.query(r,t)).rows[0].property_id,w=`
      UPDATE users
      SET first_listing_free = TRUE
      WHERE identity_number = $1
    `;await T.query(w,[y]),T.release();let P=c().join(process.cwd(),"public","pictures",d,S.toString());await n.promises.mkdir(P,{recursive:!0});for(let e=0;e<g.length;e++){let r=g[e],t=Buffer.from(await r.arrayBuffer()),o=c().join(P,`${e+1}.jpg`);await n.promises.writeFile(o,t)}return a.NextResponse.json({message:"Property added successfully!",propertyId:S})}catch(e){return console.error("Error saving property:",e),a.NextResponse.json({error:"Error saving property"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/postProperty/route",pathname:"/api/postProperty",filename:"route",bundlePath:"app/api/postProperty/route"},resolvedPagePath:"C:\\Users\\Malki\\OneDrive\\שולחן העבודה\\פרויקט מאגר דירות\\Apartments\\app\\api\\postProperty\\route.tsx",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:$}=g,h="/api/postProperty/route";function E(){return(0,p.patchFetch)({serverHooks:$,staticGenerationAsyncStorage:y})}},68735:(e,r,t)=>{t.d(r,{Z:()=>s});let{Pool:o}=t(35900),s=new o({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:process.env.DB_PORT,ssl:!1})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[948,972],()=>t(92624));module.exports=o})();