"use strict";(()=>{var e={};e.id=138,e.ids=[138],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5900:e=>{e.exports=require("pg")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},2319:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>$,staticGenerationAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{POST:()=>g});var s=t(3278),i=t(5002),a=t(4877),p=t(1309),n=t(2048),l=t(5315),c=t.n(l),u=t(8966);async function g(e){try{let r,t;console.log("--- Starting POST request to add property ---");let o=await e.formData(),s=o.get("city").trim().replace(/\s+/g," "),i=o.get("neighborhood").trim().replace(/\s+/g," "),a=o.get("price").trim(),l=o.get("rooms").trim(),g=o.get("propertyType").trim(),d=o.getAll("images"),m=d.map((e,r)=>`${r+1}.jpg`),y=o.get("userId").trim(),$="true"===o.get("hasBalcony"),h=parseInt(o.get("floor").trim(),10),f=o.get("contactSeller").trim(),E=o.get("address").trim(),R="true"===o.get("elevator"),_="true"===o.get("warehouse"),v="true"===o.get("parking");console.log({city:s,neighborhood:i,price:a,rooms:l,propertyType:g,userId:y,hasBalcony:$,floor:h,contactSeller:f,address:E,elevator:R,warehouse:_,parking:v});let T=await u.Z.connect(),S=`{${m.join(",")}}`;if("Apartment"===g)r=`
        INSERT INTO apartments (city, neighborhood, price, rooms, image_paths, user_id, has_balcony, floor, contact_seller, address, elevator, warehouse, parking)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13)
        RETURNING property_id`,t=[s,i,a,l,S,y,$,h,f,E,R,_,v];else if("Project"===g)r=`
        INSERT INTO projects (city, neighborhood, price, rooms, image_paths)
        VALUES ($1, $2, $3, $4, $5)
        RETURNING property_id`,t=[s,i,a,l,S];else if("Land"===g)r=`
        INSERT INTO lands (city, neighborhood, price, rooms, image_paths)
        VALUES ($1, $2, $3, $4, $5)
        RETURNING property_id`,t=[s,i,a,l,S];else if("Business"===g)r=`
        INSERT INTO business (city, neighborhood, price, rooms, image_paths)
        VALUES ($1, $2, $3, $4, $5)
        RETURNING property_id`,t=[s,i,a,l,S];else throw Error("Invalid property type");console.log("Executing query to insert property into the database");let N=(await T.query(r,t)).rows[0].property_id;console.log(`Property inserted with ID: ${N}`);let P=`
      UPDATE users
      SET first_listing_free = TRUE
      WHERE identity_number = $1
    `;await T.query(P,[y]),console.log(`User ${y}'s first_listing_free has been updated to TRUE`),T.release();let w=c().join(process.cwd(),"public","pictures",g,N.toString());console.log(`Creating directory for property images at: ${w}`),await n.promises.mkdir(w,{recursive:!0});for(let e=0;e<d.length;e++){let r=d[e],t=Buffer.from(await r.arrayBuffer()),o=c().join(w,`${e+1}.jpg`);console.log(`Saving image to: ${o}`),await n.promises.writeFile(o,t)}return p.NextResponse.json({message:"Property added successfully!",propertyId:N})}catch(e){return console.error("Error saving property:",e),p.NextResponse.json({error:"Error saving property"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/postProperty/route",pathname:"/api/postProperty",filename:"route",bundlePath:"app/api/postProperty/route"},resolvedPagePath:"C:\\Users\\Malki\\OneDrive\\שולחן העבודה\\פרויקט מאגר דירות\\Apartments\\app\\api\\postProperty\\route.tsx",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:$}=d,h="/api/postProperty/route";function f(){return(0,a.patchFetch)({serverHooks:$,staticGenerationAsyncStorage:y})}},8966:(e,r,t)=>{t.d(r,{Z:()=>s});let{Pool:o}=t(5900),s=new o({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:process.env.DB_PORT,ssl:{rejectUnauthorized:!1}})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[379,833],()=>t(2319));module.exports=o})();