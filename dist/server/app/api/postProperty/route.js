"use strict";(()=>{var e={};e.id=9138,e.ids=[9138],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},92624:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>$});var o={};t.r(o),t.d(o,{POST:()=>g});var s=t(49303),i=t(88716),a=t(60670),n=t(87070),l=t(92048),p=t(55315),c=t.n(p),u=t(68735);async function g(e){try{let r,t;let o=await e.formData();console.log("Form data received:",Object.fromEntries(o.entries())),Object.fromEntries(o.entries());let s=o.get("city")?.trim().replace(/\s+/g," ")||"",i=o.get("neighborhood")?.trim().replace(/\s+/g," ")||"",a=o.get("price")?.trim()||"",p=o.get("rooms")?.trim()||"",g=o.get("propertyType")?.trim()||"",d=o.getAll("images"),m=d.map((e,r)=>`${r+1}.jpg`),$=o.get("userId")?.trim()||"",y="true"===o.get("hasBalcony"),h=parseInt(o.get("floor")?.trim()||"0",10),_=o.get("contactSeller")?.trim()||"",E=o.get("address")?.trim()||"",f="true"===o.get("elevator"),v="true"===o.get("warehouse"),S="true"===o.get("parking"),b="true"===o.get("isBuilt"),R="true"===o.get("buildable_area"),P=o.get("business_type")?.trim()||"",N=o.get("monthly_yield")?.trim()||"",T=o.get("size")?.trim()||"",w=await u.Z.connect(),A=`{${m.join(",")}}`;if("Apartment"===g)r=`
        INSERT INTO apartments (city, neighborhood, price, rooms, image_paths, user_id, has_balcony, floor, contact_seller, address, elevator, warehouse, parking)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13)
        RETURNING property_id`,t=[s,i,a,p,A,$,y,h,_,E,f,v,S];else if("Project"===g)r=`
        INSERT INTO projects (city, neighborhood, price, rooms, image_paths, user_id, has_balcony, floor, contact_seller, address, elevator, warehouse, parking, isBuilt)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14)
        RETURNING property_id`,t=[s,i,a,p,A,$,y,h,_,E,f,v,S,b];else if("Land"===g)r=`
        INSERT INTO lands (city, neighborhood, price, size, buildable_area, user_id, address, contact_info)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
        RETURNING property_id`,t=[s,i,a,T,R,$,E,_];else if("Business"===g)r=`
        INSERT INTO business (city, neighborhood, price, size, business_type, monthly_yield, user_id, address, contact_info)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
        RETURNING property_id`,t=[s,i,a||null,T||null,P||null,N||null,$||null,E||null,_||null];else throw Error("Invalid property type");let D=(await w.query(r,t)).rows[0].property_id;await w.query("UPDATE users SET remaining_listings = remaining_listings - 1 WHERE identity_number = $1",[$]),w.release(),console.log("\uD83D\uDCC1 __dirname:",__dirname);let I=c().join(__dirname,"../../../../../../public/userfiles/pictures",g,D.toString());console.log("\uD83D\uDCC2 Saving images to relative path:",I),console.log("--- IMAGE UPLOAD PROCESS START ---");try{await l.promises.mkdir(I,{recursive:!0});let e=await l.promises.stat(I).then(()=>!0).catch(()=>!1);console.log("Directory created:",e)}catch(e){throw console.error("❌ Failed to create image directory:",e),e}console.log("Number of images to save:",d.length);for(let e=0;e<d.length;e++){let r=d[e];console.log(`→ Processing image #${e+1}: ${r.name}, ${r.size} bytes`);try{let t=Buffer.from(await r.arrayBuffer());console.log(`→ Buffer created, size: ${t.length} bytes`);let o=c().join(I,`${e+1}.jpg`);console.log("→ Saving to:",o),await l.promises.writeFile(o,t);let s=await l.promises.stat(o).then(()=>!0).catch(()=>!1);console.log(`✓ Image #${e+1} saved?`,s)}catch(r){console.error(`❌ Error saving image #${e+1}:`,r)}}return console.log("--- IMAGE UPLOAD PROCESS END ---"),n.NextResponse.json({message:"Property added successfully!",propertyId:D})}catch(e){return console.error("❌ Error saving property:",e),n.NextResponse.json({error:"Error saving property"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/postProperty/route",pathname:"/api/postProperty",filename:"route",bundlePath:"app/api/postProperty/route"},resolvedPagePath:"C:\\Users\\Malki\\OneDrive\\שולחן העבודה\\פרויקט מאגר דירות\\Apartments\\app\\api\\postProperty\\route.tsx",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:$,serverHooks:y}=d,h="/api/postProperty/route";function _(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:$})}},68735:(e,r,t)=>{t.d(r,{Z:()=>s});let{Pool:o}=t(35900),s=new o({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:process.env.DB_PORT,ssl:!1})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972],()=>t(92624));module.exports=o})();