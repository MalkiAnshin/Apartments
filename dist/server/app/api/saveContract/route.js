"use strict";(()=>{var e={};e.id=708,e.ids=[708],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5900:e=>{e.exports=require("pg")},5816:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l});var r={};s.r(r),s.d(r,{POST:()=>p});var o=s(3278),n=s(5002),a=s(4877),i=s(1309),c=s(8966);async function p(e){try{console.log("--- Starting POST request to save contract ---");let{userId:t,property_type:s,fileName:r,pdfBytes:o,signed_date:n,property_id:a,notes:p}=await e.json();console.log("Parsed request body:",{userId:t,property_type:s,fileName:r,property_id:a,notes:p,pdfBytes:o?"[PDF Content Present]":"[Missing PDF Content]"});let u=[];if(t||u.push("userId"),s||u.push("property_type"),r||u.push("fileName"),a||u.push("property_id"),p||u.push("notes"),o||u.push("pdfBytes"),u.length>0)return console.error("Missing required fields:",u),i.NextResponse.json({success:!1,message:"Missing required fields",missingFields:u},{status:400});let d=n||new Date().toISOString();console.log(`Using signed_date: ${d}`);let l=await c.Z.query("INSERT INTO contracts (user_id, property_type, file_name, signed_date, property_id, notes) VALUES ($1, $2, $3, $4, $5, $6) RETURNING contract_id",[t,s,r,d,a,p]);if(!l||0===l.rows.length)return console.error("Failed to insert contract data."),i.NextResponse.json({success:!1,message:"Failed to insert contract data"},{status:500});let g=l.rows[0].contract_id;return console.log(`Successfully inserted contract with ID: ${g}`),i.NextResponse.json({success:!0,contractId:g,message:"Contract saved successfully"})}catch(e){return console.error("Error saving contract:",e),i.NextResponse.json({success:!1,message:"Error saving contract",error:e.message},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/saveContract/route",pathname:"/api/saveContract",filename:"route",bundlePath:"app/api/saveContract/route"},resolvedPagePath:"C:\\Users\\Malki\\OneDrive\\שולחן העבודה\\פרויקט מאגר דירות\\Apartments\\app\\api\\saveContract\\route.tsx",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:g}=u,v="/api/saveContract/route";function h(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:l})}},8966:(e,t,s)=>{s.d(t,{Z:()=>o});let{Pool:r}=s(5900),o=new r({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:process.env.DB_PORT,ssl:{rejectUnauthorized:!1}})}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[379,833],()=>s(5816));module.exports=r})();