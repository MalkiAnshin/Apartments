"use strict";(()=>{var e={};e.id=708,e.ids=[708],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5900:e=>{e.exports=require("pg")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},1476:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>v,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>l});var a=t(9303),o=t(8716),n=t(670),i=t(7070),p=t(8735),c=t(2048),u=t.n(c),d=t(5315),g=t.n(d);async function l(e){try{let r=await e.formData(),t=r.get("pdf"),s=r.get("image"),a=r.get("userId"),o=r.get("property_type"),n=r.get("signed_date"),c=r.get("property_id"),d=r.get("notes");if(!t||!a||!o||!n||!c||!d||!s)return i.NextResponse.json({success:!1,message:"Missing required fields"},{status:400});let l=(await p.Z.query("INSERT INTO contracts (user_id, property_type, file_name, signed_date, property_id, notes) VALUES ($1, $2, $3, $4, $5, $6) RETURNING contract_id",[a,o,"contract.pdf",n,c,d])).rows[0].contract_id,f=g().join(`public/contracts/${o}`,`${l}`),v=g().join(f,"contract.pdf"),m=g().join(f,"id_image.png");u().mkdirSync(f,{recursive:!0});let y=Buffer.from(await t.arrayBuffer());u().writeFileSync(v,y);let _=Buffer.from(await s.arrayBuffer());return u().writeFileSync(m,_),i.NextResponse.json({success:!0,contractId:l,message:"Contract and ID image saved successfully"})}catch(e){return console.error("Error saving contract:",e),i.NextResponse.json({success:!1,message:"Error saving contract",error:e.message},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/saveContract/route",pathname:"/api/saveContract",filename:"route",bundlePath:"app/api/saveContract/route"},resolvedPagePath:"C:\\Users\\Malki\\OneDrive\\שולחן העבודה\\פרויקט מאגר דירות\\Apartments\\app\\api\\saveContract\\route.tsx",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:m,serverHooks:y}=f,_="/api/saveContract/route";function x(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},8735:(e,r,t)=>{t.d(r,{Z:()=>a});let{Pool:s}=t(5900),a=new s({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:process.env.DB_PORT,ssl:!1})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972],()=>t(1476));module.exports=s})();