"use strict";(()=>{var e={};e.id=4478,e.ids=[4478],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},30806:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var s={};t.r(s),t.d(s,{POST:()=>g});var o=t(49303),i=t(88716),a=t(60670),n=t(87070),p=t(92048),l=t(55315),u=t.n(l),d=t(68735);async function g(e){let r;try{let t,s;let o=await e.formData(),i=o.get("propertyType")?.trim()||"",a=o.get("city")?.trim()||"",l=o.get("neighborhood")?.trim()||"",g=parseFloat(o.get("price")?.trim()||"0"),c=parseInt(o.get("rooms")?.trim()||"0",10),m="true"===o.get("hasBalcony"),y=o.get("userId")?.trim()||"",v=parseInt(o.get("floor")?.trim()||"0",10),h="true"===o.get("parking"),f="true"===o.get("warehouse"),w="true"===o.get("elevator"),$=o.get("address")?.trim()||"",x=o.get("contactSeller")?.trim()||"",N=o.getAll("images");if(0===N.length)return console.log("No images provided"),n.NextResponse.json({error:"At least one image must be provided"},{status:400});let P=N.map((e,r)=>`${r+1}.jpg`);if(!i||!a||!l||isNaN(g)||isNaN(c)||isNaN(v)||!m||!y||!$||!x)return console.log("Missing required fields:",{propertyType:i,city:a,neighborhood:l,price:g,rooms:c,floor:v,hasBalcony:m,userId:y,address:$,contactSeller:x}),n.NextResponse.json({error:"All required fields must be provided"},{status:400});if(console.log("Parsed values:",{propertyType:i,city:a,neighborhood:l,price:g,rooms:c,userId:y,floor:v,hasBalcony:m,imageNames:P,parking:h,warehouse:f,elevator:w,address:$,contactSeller:x}),r=await d.Z.connect(),"Apartment"===i)t=`
        INSERT INTO apartments (city, neighborhood, price, rooms, floor, has_balcony, user_id, parking, warehouse, elevator, address, contact_seller, image_paths)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING property_id
      `,s=[a,l,g,c,v,m,y,h,f,w,$,x,P];else throw Error("Invalid property type");let _=(await r.query(t,s)).rows[0].property_id;console.log("Inserted property ID:",_);let F=u().join(process.cwd(),"..","uploads","pictures",i,_.toString());await p.promises.mkdir(F,{recursive:!0});for(let e=0;e<N.length;e++){let r=N[e],t=Buffer.from(await r.arrayBuffer()),s=u().join(F,`${e+1}.jpg`);await p.promises.writeFile(s,t)}return(await r.query("UPDATE users SET  = remaining_listings - 1 WHERE user_id = $1",[y])).rowCount>0?console.log(`User ID ${y} remaining_listings decreased.`):console.log(`No user found with ID ${y} or no listings remaining.`),n.NextResponse.json({message:"Property added successfully!",propertyId:_})}catch(e){return console.error("Error saving property:",e),n.NextResponse.json({error:"Error saving property"},{status:500})}finally{r&&r.release()}}let c=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/PropertyFormFields/route",pathname:"/api/PropertyFormFields",filename:"route",bundlePath:"app/api/PropertyFormFields/route"},resolvedPagePath:"C:\\Users\\Malki\\OneDrive\\שולחן העבודה\\פרויקט מאגר דירות\\Apartments\\app\\api\\PropertyFormFields\\route.tsx",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:v}=c,h="/api/PropertyFormFields/route";function f(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},68735:(e,r,t)=>{t.d(r,{Z:()=>o});let{Pool:s}=t(35900),o=new s({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:process.env.DB_PORT,ssl:!1})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972],()=>t(30806));module.exports=s})();