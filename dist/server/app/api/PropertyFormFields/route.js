"use strict";(()=>{var e={};e.id=478,e.ids=[478],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},30806:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{POST:()=>c});var s=t(49303),i=t(88716),a=t(60670),p=t(87070),n=t(92048),l=t(55315),u=t.n(l),d=t(68735);async function c(e){let r;try{let t,o;let s=await e.formData(),i=s.get("propertyType")?.trim()||"",a=s.get("city")?.trim()||"",l=s.get("neighborhood")?.trim()||"",c=parseFloat(s.get("price")?.trim()||"0"),g=parseInt(s.get("rooms")?.trim()||"0",10),m="true"===s.get("hasBalcony"),y=s.get("userId")?.trim()||"",f=parseInt(s.get("floor")?.trim()||"0",10),v="true"===s.get("parking"),h="true"===s.get("warehouse"),w="true"===s.get("elevator"),N=s.get("address")?.trim()||"",$=s.get("contactSeller")?.trim()||"",x=s.getAll("images");if(0===x.length)return console.log("No images provided"),p.NextResponse.json({error:"At least one image must be provided"},{status:400});let P=x.map((e,r)=>`${r+1}.jpg`);if(!i||!a||!l||isNaN(c)||isNaN(g)||isNaN(f)||!m||!y||!N||!$)return console.log("Missing required fields:",{propertyType:i,city:a,neighborhood:l,price:c,rooms:g,floor:f,hasBalcony:m,userId:y,address:N,contactSeller:$}),p.NextResponse.json({error:"All required fields must be provided"},{status:400});if(console.log("Parsed values:",{propertyType:i,city:a,neighborhood:l,price:c,rooms:g,userId:y,floor:f,hasBalcony:m,imageNames:P,parking:v,warehouse:h,elevator:w,address:N,contactSeller:$}),r=await d.Z.connect(),"Apartment"===i)t=`
        INSERT INTO apartments (city, neighborhood, price, rooms, floor, has_balcony, user_id, parking, warehouse, elevator, address, contact_seller, image_paths)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13) RETURNING property_id
      `,o=[a,l,c,g,f,m,y,v,h,w,N,$,P];else throw Error("Invalid property type");let _=(await r.query(t,o)).rows[0].property_id;console.log("Inserted property ID:",_);let R=u().join(process.cwd(),"public","pictures",i,_.toString());await n.promises.mkdir(R,{recursive:!0});for(let e=0;e<x.length;e++){let r=x[e],t=Buffer.from(await r.arrayBuffer()),o=u().join(R,`${e+1}.jpg`);await n.promises.writeFile(o,t)}return(await r.query("UPDATE users SET first_listing_free = TRUE WHERE user_id = $1",[y])).rowCount>0?console.log(`User ID ${y} first_listing_free updated to TRUE.`):console.log(`No user found with ID ${y}. No update was made.`),p.NextResponse.json({message:"Property added successfully!",propertyId:_})}catch(e){return console.error("Error saving property:",e),p.NextResponse.json({error:"Error saving property"},{status:500})}finally{r&&r.release()}}let g=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/PropertyFormFields/route",pathname:"/api/PropertyFormFields",filename:"route",bundlePath:"app/api/PropertyFormFields/route"},resolvedPagePath:"C:\\Users\\Malki\\OneDrive\\שולחן העבודה\\פרויקט מאגר דירות\\Apartments\\app\\api\\PropertyFormFields\\route.tsx",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:f}=g,v="/api/PropertyFormFields/route";function h(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:y})}},68735:(e,r,t)=>{t.d(r,{Z:()=>s});let{Pool:o}=t(35900),s=new o({user:process.env.DB_USER,host:process.env.DB_HOST,database:process.env.DB_NAME,password:process.env.DB_PASSWORD,port:process.env.DB_PORT,ssl:!1})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[276,972],()=>t(30806));module.exports=o})();