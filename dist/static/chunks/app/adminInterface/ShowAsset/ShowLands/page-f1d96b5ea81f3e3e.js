(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{63353:function(e,t,r){Promise.resolve().then(r.bind(r,54915))},54915:function(e,t,r){"use strict";r.r(t);var s=r(57437),a=r(2265),o=r(86047);t.default=()=>{let[e,t]=(0,a.useState)([]),[r,l]=(0,a.useState)(null),[c,n]=(0,a.useState)(null),[d,i]=(0,a.useState)({min:0,max:1e8}),[h,x]=(0,a.useState)([]),[m,p]=(0,a.useState)(null),[b,g]=(0,a.useState)(!1),u=async()=>{try{let e=encodeURIComponent((null==c?void 0:c.trim())||""),r=await fetch("/api/AdminInterface/ShowAsset/ShowLands?city=".concat(e));if(!r.ok)throw Error("Response from server was not OK");let s=await r.json();t(s)}catch(e){l("Error fetching lands: "+(e instanceof Error?e.message:"Unknown error")),console.error(e)}},f=async r=>{if(window.confirm("האם אתה בטוח שברצונך למחוק נכס זה?"))try{if(!(await fetch("/api/AdminInterface/DeletedAsset/DeleteLand?property_id=".concat(r),{method:"DELETE"})).ok)throw Error("מחיקה נכשלה");alert("הנכס נמחק בהצלחה"),t(e.filter(e=>e.property_id!==r))}catch(e){l("Error deleting land: "+(e instanceof Error?e.message:"Unknown error")),console.error(e)}},j=async e=>{try{p(e);let t=await fetch("/api/AdminInterface/contracts?property_id=".concat(e));if(!t.ok)throw Error("Response from server was not OK");let r=await t.json();x(r),g(!0)}catch(e){l("Error fetching contracts: "+(e instanceof Error?e.message:"Unknown error")),console.error(e)}};(0,a.useEffect)(()=>{u()},[c]);let w=e.filter(e=>e.price>=d.min&&e.price<=d.max),N=(e,t)=>{let r="/contracts/".concat(e,"/").concat(t,"/contract.pdf");try{window.open(r,"_blank"),console.log("נפתח חלון חדש עם ה-PDF")}catch(e){console.error("שגיאה בפתיחת ה-PDF:",e)}},y=(e,t)=>{let r="/contracts/".concat(e,"/").concat(t,"/id_image.png"),s="/contracts/".concat(e,"/").concat(t,"/id_image.jpg"),a=e=>{window.open(e,"_blank")};a(r),a(s)};return(0,s.jsx)("div",{className:"bg-transparent text-white min-h-screen flex flex-col items-center p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-4xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gold text-center",children:"רשימת קרקעות"}),r&&(0,s.jsxs)("div",{className:"text-red-600 mb-4 text-center",children:["שגיאה: ",r]}),(0,s.jsx)(o.Z,{onCitySelect:n}),w.length>0?(0,s.jsxs)("table",{className:"min-w-full bg-transparent border border-gold mb-6",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gold",children:[(0,s.jsx)("th",{className:"text-left p-4",children:"מזהה נכס"}),(0,s.jsx)("th",{className:"text-left p-4",children:"עיר"}),(0,s.jsx)("th",{className:"text-left p-4",children:"מחיר"}),(0,s.jsx)("th",{className:"text-left p-4",children:"פעולה"})]})}),(0,s.jsx)("tbody",{children:w.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gold ".concat(m===e.property_id?"bg-gold/10":""),children:[(0,s.jsx)("td",{className:"p-4",children:e.property_id}),(0,s.jsx)("td",{className:"p-4",children:e.city}),(0,s.jsx)("td",{className:"p-4",children:Number(e.price).toLocaleString("he-IL",{maximumFractionDigits:0})}),(0,s.jsx)("td",{className:"p-4",children:e.rooms}),(0,s.jsx)("button",{onClick:()=>f(e.property_id),className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700",children:"מחק נכס"}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsx)("button",{onClick:()=>j(e.property_id),className:"bg-gold text-black px-4 py-2 rounded hover:bg-yellow-600",children:"הצג חוזים"})})]},e.property_id))})]}):(0,s.jsx)("p",{className:"text-gray-400 text-center",children:"...טוען"}),b&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70 flex justify-center items-center z-50",children:(0,s.jsxs)("div",{className:"bg-black text-gold p-6 rounded-lg max-w-4xl w-full max-h-screen overflow-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"חוזים"}),(0,s.jsx)("button",{onClick:()=>g(!1),className:"text-red-500 mb-4 text-lg",children:"סגור"}),(0,s.jsxs)("div",{className:"overflow-x-auto max-h-80",children:[" ",(0,s.jsxs)("table",{className:"min-w-full bg-transparent border border-gold rounded-lg overflow-hidden shadow-lg",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gold text-gold",children:[(0,s.jsx)("th",{className:"p-4",children:"מזהה חוזה"}),(0,s.jsx)("th",{className:"p-4",children:"מזהה נכס"}),(0,s.jsx)("th",{className:"p-4",children:"סוג נכס"}),(0,s.jsx)("th",{className:"p-4 text-center",children:"תאריך"}),(0,s.jsx)("th",{className:"p-4",children:"מזהה משתמש"})]})}),(0,s.jsx)("tbody",{children:h.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-gold hover:bg-gold/10 transition",children:[(0,s.jsx)("td",{className:"p-4 text-gold",children:e.contract_id}),(0,s.jsx)("td",{className:"p-4 text-gold",children:e.property_id}),(0,s.jsx)("td",{className:"p-4 text-gold",children:e.property_type}),(0,s.jsx)("td",{className:"p-4 text-gold",children:e.signed_date}),(0,s.jsx)("td",{className:"p-4 text-gold",children:e.user_id}),(0,s.jsx)("td",{className:"p-4 text-center",children:(0,s.jsx)("button",{className:"bg-transparent border border-gold text-gold py-1 px-3 rounded hover:bg-gold hover:text-black transition shadow-gold-glow",onClick:()=>N(e.property_type,e.contract_id),children:"הצגת החוזה"})}),(0,s.jsx)("td",{className:"p-4 text-center",children:(0,s.jsx)("button",{className:"bg-transparent border border-gold text-gold py-1 px-3 rounded hover:bg-gold hover:text-black transition shadow-gold-glow",onClick:()=>y(e.property_type,e.contract_id),children:"הצגת צילום ת.ז."})})]},t))})]})]})]})})]})})}},86047:function(e,t,r){"use strict";var s=r(57437),a=r(2265);t.Z=e=>{let{onCitySelect:t}=e,[r,o]=(0,a.useState)([]),[l,c]=(0,a.useState)(""),[n,d]=(0,a.useState)(null),[i,h]=(0,a.useState)(null),x=async()=>{try{var e;let t=await fetch("https://data.gov.il/api/3/action/datastore_search?resource_id=d4901968-dad3-4845-a9b0-a57d027f11ab");if(!t.ok)throw Error("Network response was not ok");let r=await t.json();if(r.success&&(null===(e=r.result)||void 0===e?void 0:e.records)){let e=r.result.records.map(e=>e["שם_ישוב"]).filter(e=>e);o(e)}else throw Error("Unexpected data format")}catch(e){h("Error fetching cities: ".concat(e instanceof Error?e.message:"An unknown error occurred")),console.error("Error fetching cities:",e)}};(0,a.useEffect)(()=>{x()},[]);let m=e=>{d(e),c(""),t(e)},p=r.filter(e=>e.toLowerCase().includes(l.toLowerCase()));return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"city-search",className:"block text-lg font-semibold mb-2 text-center",children:"בחר עיר:"}),(0,s.jsx)("input",{id:"city-search",type:"text",placeholder:"...הקלד שם העיר",value:l||n||"",onChange:e=>{c(e.target.value),d(null)},className:"bg-gray-800 text-white border border-gold rounded-md px-4 py-2 w-full"}),l&&(0,s.jsx)("ul",{className:"mt-2 bg-gray-800 border border-gold rounded-md max-h-48 overflow-y-auto",children:p.map((e,t)=>(0,s.jsx)("li",{onClick:()=>m(e),className:"px-4 py-2 cursor-pointer hover:bg-gray-700",children:e},t))}),i&&(0,s.jsx)("div",{className:"text-red-600 mb-4 text-center",children:i})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=63353)}),_N_E=e.O()}]);