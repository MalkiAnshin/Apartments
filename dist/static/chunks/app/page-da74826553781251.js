(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2885:function(e,t,r){Promise.resolve().then(r.bind(r,2980))},1054:function(e,t,r){"use strict";r.d(t,{R:function(){return o},b:function(){return n}});var s=r(7437),a=r(2265);let l=(0,a.createContext)(void 0),o=e=>{let{children:t}=e,[r,o]=(0,a.useState)(null),[n,c]=(0,a.useState)(null),[i,d]=(0,a.useState)(null),[u,x]=(0,a.useState)(null);return(0,s.jsx)(l.Provider,{value:{user:r,setUser:o,userType:n,setUserType:c,userId:i,setUserId:d,firstListingFree:u,setFirstListingFree:x},children:t})},n=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useGlobalContext must be used within a GlobalProvider");return e}},2980:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var s=r(7437),a=r(2265),l=r(9376),o=r(7938),n=r.n(o),c=r(9067),i=r(9533),d=r(2957).lW,u=e=>{let{selectedProperty:t,property_type:r,onClose:l}=e,[o,u]=(0,a.useState)(null),[x,m]=(0,a.useState)(""),[h,g]=(0,a.useState)(""),[p,f]=(0,a.useState)(""),[b,y]=(0,a.useState)(null),[j,w]=(0,a.useState)(null),N=t.property_id,v=(0,a.useRef)(null),S=(0,a.useRef)(null),k=localStorage.getItem("user"),E=k?JSON.parse(k).userId:null;(0,a.useEffect)(()=>{let e=new Date().toISOString().split("T")[0];g(e),console.log("Today's date set:",e)},[]);let C=async()=>{if(!o||!x||!h||!r||!b||!N||!p){alert("אנא מלא את כל השדות."),console.log("Missing fields:",{signature:o,name:x,signed_date:h,property_type:r,image:b,property_id:N,notes:p});return}try{let e=await c.PDFDocument.create();e.registerFontkit(i);let t=e.addPage([600,800]),s=await fetch("/fonts/NotoSansHebrew.ttf").then(e=>e.arrayBuffer()),a=await e.embedFont(s),{width:o,height:n}=t.getSize();if(t.drawText("פרטי החוזה:",{x:50,y:n-100,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),t.drawText("סוג נכס: ".concat(r),{x:50,y:n-120,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),t.drawText("מזהה נכס : ".concat(N),{x:50,y:n-120,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),t.drawText("תאריך: ".concat(h),{x:50,y:n-120,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),t.drawText("שם: ".concat(x),{x:50,y:n-140,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),t.drawText("תעודת זהות: ".concat(E),{x:50,y:n-160,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),t.drawText("הערות: ".concat(p),{x:50,y:n-180,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),t.drawText("שם: ".concat(x),{x:50,y:n-140,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),t.drawText("תעודת זהות: ".concat(j),{x:50,y:n-140,size:12,font:a,color:(0,c.rgb)(0,0,0),maxWidth:o-100,lineHeight:14.399999999999999}),b){let s=new FileReader;s.onload=async function(s){var a;let o=null===(a=s.target)||void 0===a?void 0:a.result,c=await e.embedJpg(o);t.drawImage(c,{x:50,y:n-400,width:100,height:60}),console.log("ID card image added to PDF");let i=await e.save();console.log("PDF document saved");let u=d.from(i).toString("base64");console.log("PDF document saved without ID card image");let m=await fetch("/api/saveContract",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pdfBytes:u,fileName:"contract_".concat(x,"_").concat(h,".pdf"),userId:E,property_type:r,signed_date:h,property_id:N,notes:p})});if(m.ok)alert('החוזה נשמר בתיקיית "חוזה" בהצלחה!'),l();else{alert("שגיאה בשמירת החוזה.");let e=await m.text();console.error("Server error:",e)}},s.readAsArrayBuffer(b)}else{let t=await e.save(),s=d.from(t).toString("base64");console.log("מנסה לשמור את החוזה");let a=await fetch("/api/saveContract",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pdfBytes:s,fileName:"contract_".concat(x,"_").concat(h,".pdf"),userId:E,property_type:r,signed_date:h,property_id:N,notes:p})});if(console.log("נשלחה הבקשה",a),console.log({pdfBytes:s,fileName:"contract_".concat(x,"_").concat(h,".pdf"),userId:"userId",property_type:r,signed_date:h,notes:p}),a.ok)alert('החוזה נשמר בתיקיית "חוזה" בהצלחה!'),l();else{alert("שגיאה בשמירת החוזה.");let e=await a.text();console.error("Server error:",e)}}}catch(e){console.error("שגיאה ביצירת ה-PDF:",e)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white text-black p-6 rounded-lg w-full max-w-3xl max-h-[90%] overflow-auto",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"חתום על החוזה"}),(0,s.jsx)("p",{className:"text-base mb-2",children:"טופס הזמנת שירותי תיווך בלעדיים למכירת/השכרת נכס מקרקעין 0014"}),(0,s.jsx)("p",{className:"text-sm mb-2",children:'(בהתאם ל"חוק המתווכים במקרקעין, התשנ"ז 1996")'}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"סעיפים:"}),(0,s.jsx)("li",{children:'הלקוח מזמין מהמתווח שירותי תיווך מקרקעין, כדי לקבל שירותי תיווך בקשר לנכסים המפורטים להלן עבורנו ועבור (להלן "שולחו")'}),(0,s.jsx)("li",{children:'הלקוחות מאשרים כי המתווך הציג בפניהם את הנכסים המפורטים להלן, והם מתחייבים לדווח ל "שילת נכסים" מיד על משא ומתן המתנהל עמם בקשר לאחד או יותר מהנכסים, וכן מיד עם חתימת הסכם מחייב ו/או עם התחייבות לביצוע העסקה, המוקדם ביניהם, ביחס לאחד או יותר מהנכסים להלן'}),(0,s.jsx)("li",{children:'הלקוחות מתחייבים לשלם ל "שילת נכסים" דמי תיווך בשיעור המפורט להלן בסעיף 5 מיד עם חתימת הסכם מחייב ו/או עם התחייבות לביצוע העסקה, המוקדם ביניהם, בנוגע לאחד או יותר מהנכסים המפורטים להלן, עמנו או עם מי מטעמנו, או עם כל גוף שאנו או מי מיטעמנו קשור אליו, או עם כל מי שמסרנו פרטים בקשר לנכסים'}),(0,s.jsx)("li",{children:'הקונים מתחייבים לא למסור לגורם כלשהוא מידע שיקבלו מ "שילת נכסים" בנוגע לנכסים שלהלן, והם מתחייבים לפצות את "שילת נכסים" על כל נזק שיגרם להם באם יפרו התחייבות זו.'}),(0,s.jsxs)("li",{children:['דמי התיווך ישולמו ל "שילת נכסים" כמפורט בסעיף 3 לעיל ויהיו כדלקמן:',(0,s.jsxs)("ul",{className:"list-disc list-inside pl-4",children:[(0,s.jsx)("li",{children:'בקניה: 2% בתוספת מע"מ ממחיר המכירה הכולל של הנכס אך לא פחות מ- 10,000 ₪ בתוספת מע"מ.'}),(0,s.jsx)("li",{children:'בשכירות: דמי שכירות של חודש אחד בתוספת מע"מ.'}),(0,s.jsx)("li",{children:'האמור לעיל בא בנוסף לזכותה של שילת אורם – "שילת נכסים" לנכות דמי תיווך מהמוכר/משכיר.'}),(0,s.jsx)("li",{children:'כאמור דמי התיווך ישולמו מיד עם חתימת הסכם מחייב ו/או עם התחייבות לביצוע העסקה המוקדם מבניהם. כל תשלום אשר לא יעשה בתוך שלושה ימים ממועד זה ישא הצמדה וריבית כנהוג בחשבונות עו"ש מהיום לתשלום ועד יום פירעון התשלום בפועל.'}),(0,s.jsx)("li",{children:'הלקוח מצהיר כי ידוע לו שדמי התיווך יגבו על ידי "בת שבע נדל"ן" וכנגד חשבוניות מס כחוק מטעם "שילת נכסים".'})]})]}),(0,s.jsx)("li",{children:'הלקוח מאשר שהומלץ לו ע"י המתווך להסתייע בשירותי עורך דין ו/או מומחים אחראים לפי הענין והצורך במהלך העסקה.'}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("ul",{className:"list-disc list-inside pl-4"})}),(0,s.jsx)("label",{className:"block mb-1",children:"תאריך:"}),(0,s.jsx)("input",{type:"signed_date",value:h,onChange:e=>g(e.target.value),className:"border rounded w-full p-2"}),(0,s.jsxs)("p",{className:"mb-4",children:["שם: ",(0,s.jsx)("input",{type:"text",value:x,onChange:e=>m(e.target.value),className:"bg-gray-200 border border-gray-300 rounded-md px-4 py-2 w-full"})]}),(0,s.jsxs)("p",{className:"mb-4",children:["הערות: ",(0,s.jsx)("textarea",{value:p,onChange:e=>f(e.target.value),className:"bg-gray-200 border border-gray-300 rounded-md px-4 py-2 w-full"})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)(n(),{ref:v,canvasProps:{className:"border border-gray-300 w-full h-40"},onEnd:()=>{v.current&&u(v.current.toDataURL())}})}),(0,s.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,s.jsxs)("button",{onClick:()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.click()},className:"bg-gray-200 border border-gray-300 rounded-md px-4 py-2 flex items-center",children:[(0,s.jsx)("svg",{className:"w-6 h-6 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 2L12 6M12 18L12 22M4.22 4.22l1.42 1.42M17.36 17.36l1.42 1.42M2 12h4m12 0h4M4.22 19.78l1.42-1.42M17.36 6.64l1.42-1.42"})}),"צירוף צילום תעודת זהות"]}),(0,s.jsx)("input",{type:"file",id:"fileInput",accept:"image/*",onChange:e=>{let t=e.target.files?e.target.files[0]:null;if(t){y(t);let e=new FileReader;e.onloadend=()=>{w(e.result)},e.readAsDataURL(t)}},ref:S,className:"hidden"})]}),j&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h3",{children:"התמונה שנבחרה:"}),(0,s.jsx)("img",{src:j,alt:"תמונה",className:"border border-gray-300 w-full h-auto"})]}),(0,s.jsxs)("div",{className:"flex justify-end",children:[(0,s.jsx)("button",{onClick:C,className:"bg-gold text-black px-4 py-2 rounded-md hover:bg-yellow-600",children:"שמור וחתום"}),(0,s.jsx)("button",{onClick:l,className:"ml-2 bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-500",children:"סגור"})]})]})})},x=e=>{let{property_id:t}=e,[r,l]=(0,a.useState)([]),[o,n]=(0,a.useState)(0),[c,i]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/apartmentsPictures?id=".concat(t));if(!e.ok)throw Error("Network response was not ok: ".concat(e.statusText));let r=await e.json();l(r.images||[])}catch(e){i("Error fetching images: ".concat(e.message)),console.error("Error fetching images:",e)}})()},[t]),c)?(0,s.jsxs)("div",{children:["Error loading images: ",c]}):(0,s.jsxs)("div",{className:"relative w-full h-64 md:h-96",children:[r.length>0?(0,s.jsx)("img",{src:r[o],alt:"Apartment ".concat(t," - Image ").concat(o+1),className:"w-full h-full object-cover rounded-md"}):(0,s.jsx)("p",{children:"אין תמונות זמינות"}),r.length>1&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{n(e=>(e-1+r.length)%r.length)},className:"absolute left-0 top-1/2 transform -translate-y-1/2 text-gray-600 text-3xl md:text-4xl",children:"◀"}),(0,s.jsx)("button",{onClick:()=>{n(e=>(e+1)%r.length)},className:"absolute right-0 top-1/2 transform -translate-y-1/2 text-gray-600 text-3xl md:text-4xl",children:"▶"})]})]})},m=r(6047),h=r(3339),g=()=>{let[e,t]=(0,a.useState)([]),[r,o]=(0,a.useState)(null),[n,c]=(0,a.useState)(!1),[i,d]=(0,a.useState)(!1),[g,p]=(0,a.useState)(null),[f,b]=(0,a.useState)(null),[y,j]=(0,a.useState)(null),[w,N]=(0,a.useState)(null),v=(0,l.useRouter)();(0,a.useEffect)(()=>{g&&(async()=>{try{let e=await fetch("/api/apartments?city=".concat(g));if(!e.ok){let t=await e.json();throw Error("Network response was not ok. Status: ".concat(e.status,", Details: ").concat(JSON.stringify(t)))}let r=await e.json();if(Array.isArray(r))t(r);else throw Error("Unexpected data format")}catch(e){N("Error fetching apartments: ".concat(e instanceof Error?e.message:"An unknown error occurred")),console.error("Error fetching apartments:",e)}})()},[g]);let S=async e=>{let t=JSON.parse(localStorage.getItem("user")||"{}").userId||null;if(!t){v.push("/login");return}try{let r=await fetch("/api/moreDetails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apartmentId:e,userId:t})});if(!r.ok){let e=await r.json();throw Error("Network response was not ok. Status: ".concat(r.status,", Details: ").concat(JSON.stringify(e)))}let s=await r.json();d(s.exists)}catch(e){N("Error checking contract: ".concat(e instanceof Error?e.message:"An unknown error occurred"))}},k=e=>{S(e.property_id),o(e),c(!0)},E=()=>{c(!1),o(null)};return(0,a.useEffect)(()=>{(async()=>{let e="/api/apartments?";g&&(e+="city=".concat(g,"&")),f&&(e+="minPrice=".concat(f.min,"&maxPrice=").concat(f.max,"&")),null!==y&&(e+="rooms=".concat(y));try{let r=await fetch(e);if(!r.ok)throw Error("Failed to fetch data, status: ".concat(r.status));let s=await r.json();t(s)}catch(e){console.error("Error fetching filtered apartments:",e),N("Error fetching apartments")}})()},[g,f,y]),(0,s.jsx)("div",{className:"text-white min-h-screen flex flex-col items-center p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-4xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gold text-center",children:"מצא את הדירה המתאימה"}),(0,s.jsx)(m.Z,{onCitySelect:p})," ",(0,s.jsx)(h.Z,{onPriceChange:b,onRoomsChange:j}),g&&(0,s.jsxs)("h2",{className:"text-2xl font-semibold mb-4 text-gold text-center",children:["דירות ב",g]}),e.length>0?(0,s.jsx)("ul",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>(0,s.jsxs)("li",{className:"bg-gray-800 p-4 rounded-lg border border-gold cursor-pointer",children:[(0,s.jsxs)("p",{className:"text-lg font-medium",children:["שכונה/איזור: ",e.neighborhood]}),(0,s.jsxs)("p",{className:"text-md text-gold",children:["מחיר: ",e.price,' ש"ח']}),(0,s.jsxs)("p",{className:"text-sm",children:["חדרים: ",e.rooms]}),(0,s.jsx)(x,{property_id:e.property_id}),(0,s.jsx)("button",{className:"mt-4 bg-gold text-black px-6 py-2 rounded-md font-semibold",onClick:()=>k(e),children:"לפרטים נוספים"}),n&&(null==r?void 0:r.property_id)===e.property_id&&(0,s.jsx)("div",{className:"relative z-50",children:i?(0,s.jsxs)("div",{className:"text-gold-500 text-center mt-4",children:[(0,s.jsxs)("p",{className:"text-lg font-medium",children:["צור קשר עם המוכר:  ",e.contact_seller]}),(0,s.jsxs)("p",{className:"text-md text-gold",children:["כתובת: ",e.address]})]}):(0,s.jsx)(u,{property_type:"apartment",selectedProperty:r,onClose:E})})]},e.property_id))}):g&&(0,s.jsx)("p",{className:"text-gray-400 text-center",children:".לא נמצאו דירות התואמות לנתוני החיפוש"})]})})},p=e=>{let{onSelect:t}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center mb-6 w-full max-w-4xl mx-auto",children:[(0,s.jsx)("label",{className:"block text-lg font-semibold mb-2 text-gold text-center",children:"בחר סוג נכס:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-4 justify-center w-full",children:["פרויקט קבלן","בתי עסק","קרקעות","דירות"].map(e=>(0,s.jsx)("button",{onClick:()=>{t(e)},className:"flex-1 min-w-[120px] py-3 px-6 text-center rounded-lg border border-gold bg-black text-gold shadow-lg hover:bg-gray-800 transition-colors duration-300 text-lg md:text-xl",children:e},e))})]})},f=()=>{let[e,t]=(0,a.useState)([]),[r,l]=(0,a.useState)([]),[o,n]=(0,a.useState)(null),[c,i]=(0,a.useState)(""),[d,u]=(0,a.useState)([]),[x,m]=(0,a.useState)(null),[h,g]=(0,a.useState)(!1),[p,f]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("https://data.gov.il/api/3/action/datastore_search?resource_id=d4901968-dad3-4845-a9b0-a57d027f11ab");if(!e.ok)throw Error("Network response was not ok");let r=await e.json();if(r.success&&r.result&&r.result.records){let e=r.result.records.map(e=>e["שם_ישוב"]).filter(e=>""!==e);t([...new Set(e)])}else throw Error("Unexpected data format")}catch(e){e instanceof Error?f("Error fetching cities: "+e.message):f("An unknown error occurred"),console.error("Error fetching cities:",e)}})()},[]),(0,a.useEffect)(()=>{l(e.filter(e=>e.toLowerCase().includes(c.toLowerCase())))},[c,e]),(0,a.useEffect)(()=>{o&&(async()=>{try{let e=await fetch("/api/lands?city=".concat(o));if(!e.ok){let t=await e.json();throw Error("Network response was not ok. Status: ".concat(e.status,", Details: ").concat(JSON.stringify(t)))}let t=await e.json();if(Array.isArray(t))u(t);else throw Error("Unexpected data format")}catch(e){e instanceof Error?f("Error fetching lands: "+e.message):f("An unknown error occurred"),console.error("Error fetching lands:",e)}})()},[o]);let b=e=>{n(e),i("")},y=e=>{m(e),g(!0)};return(0,s.jsx)("div",{className:"bg-black text-white min-h-screen flex flex-col items-center p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-4xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gold text-center",children:"מצא את הקרקע המתאימה"}),p&&(0,s.jsxs)("div",{className:"text-red-600 mb-4 text-center",children:["Error: ",p]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"city-search",className:"block text-lg font-semibold mb-2 text-center",children:"בחר עיר:"}),(0,s.jsx)("input",{id:"city-search",type:"text",placeholder:"...הקלד שם העיר",value:c,onChange:e=>{i(e.target.value)},className:"bg-gray-800 text-white border border-gold rounded-md px-4 py-2 w-full"}),c&&(0,s.jsx)("ul",{className:"mt-2 bg-gray-800 border border-gold rounded-md",children:r.map((e,t)=>(0,s.jsx)("li",{onClick:()=>b(e),className:"px-4 py-2 cursor-pointer hover:bg-gray-700",children:e},t))})]}),o&&(0,s.jsxs)("h2",{className:"text-2xl font-semibold mb-4 text-gold text-center",children:["קרקעות ב",o]}),d.length>0?(0,s.jsx)("ul",{className:"space-y-4",children:d.map((e,t)=>(0,s.jsxs)("li",{className:"bg-gray-800 p-4 rounded-lg border border-gold cursor-pointer",onClick:()=>y(e),children:[(0,s.jsxs)("p",{className:"text-lg font-medium",children:["שכונה/איזור: ",e.neighborhood]}),(0,s.jsxs)("p",{className:"text-md text-gold",children:["מחיר: $",e.price]}),(0,s.jsxs)("p",{className:"text-sm",children:["גודל: ",e.size,' מ"ר']})]},t))}):o&&(0,s.jsx)("p",{className:"text-gray-400 text-center",children:"No lands found for this city."})]})})},b=e=>{let{property_id:t}=e,[r,l]=(0,a.useState)([]),[o,n]=(0,a.useState)(0),[c,i]=(0,a.useState)(null);return((0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/businessPictures?id=".concat(t));if(!e.ok)throw Error("Network response was not ok: ".concat(e.statusText));let r=await e.json();l(r.images||[])}catch(e){i("Error fetching images: ".concat(e.message)),console.error("Error fetching images:",e)}})()},[t]),c)?(0,s.jsxs)("div",{children:["Error loading images: ",c]}):(0,s.jsxs)("div",{className:"relative w-full h-64 md:h-96",children:[r.length>0?(0,s.jsx)("img",{src:r[o],alt:"Business ".concat(t," - Image ").concat(o+1),className:"w-full h-full object-cover rounded-md"}):(0,s.jsx)("p",{children:"אין תמונות זמינות"}),r.length>1&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{n(e=>(e-1+r.length)%r.length)},className:"absolute left-0 top-1/2 transform -translate-y-1/2 text-gray-600 text-3xl md:text-4xl",children:"◀"}),(0,s.jsx)("button",{onClick:()=>{n(e=>(e+1)%r.length)},className:"absolute right-0 top-1/2 transform -translate-y-1/2 text-gray-600 text-3xl md:text-4xl",children:"▶"})]})]})},y=()=>{let[e,t]=(0,a.useState)([]),[r,o]=(0,a.useState)(null),[n,c]=(0,a.useState)(!1),[i,d]=(0,a.useState)(!1),[x,h]=(0,a.useState)(null),[g,p]=(0,a.useState)(null),f=(0,l.useRouter)();(0,a.useEffect)(()=>{console.log("Component mounted. Initial selected city:",x),x?(async()=>{console.log("Fetching businesses for city:",x);try{let e=await fetch("/api/business?city=".concat(x));if(console.log("Response status:",e.status),!e.ok){let t=await e.json();throw console.error("Error data:",t),Error("Network response was not ok. Status: ".concat(e.status,", Details: ").concat(JSON.stringify(t)))}let r=await e.json();if(console.log("Fetched businesses data:",r),Array.isArray(r))t(r),console.log("Businesses updated successfully:",r);else throw Error("Unexpected data format")}catch(e){console.error("Error fetching businesses:",e),p("Error fetching businesses: ".concat(e instanceof Error?e.message:"An unknown error occurred"))}})():console.log("No city selected. Skipping fetch.")},[x]);let y=async e=>{let t=JSON.parse(localStorage.getItem("user")||"{}").userId||null;if(console.log("Checking contract for businessId:",e,"with userId:",t),!t){console.warn("User not logged in, redirecting to login"),f.push("/login");return}try{let r=await fetch("/api/moreDetails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({businessId:e,userId:t})});if(console.log("Check contract response status:",r.status),!r.ok){let e=await r.json();throw console.error("Error data from check contract:",e),Error("Network response was not ok. Status: ".concat(r.status,", Details: ").concat(JSON.stringify(e)))}let s=await r.json();console.log("Contract data received:",s),d(s.exists)}catch(e){console.error("Error checking contract:",e),p("Error checking contract: ".concat(e instanceof Error?e.message:"An unknown error occurred"))}},j=e=>{console.log("Business clicked:",e),y(e.property_id),o(e),c(!0),console.log("Modal state updated to show for business:",e.property_id)},w=()=>{console.log("Closing modal for business:",null==r?void 0:r.property_id),c(!1),o(null)};return(0,s.jsx)("div",{className:"text-white min-h-screen flex flex-col items-center p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-4xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gold text-center",children:"מצא את העסק המתאים"}),(0,s.jsx)(m.Z,{onCitySelect:h}),x&&(0,s.jsxs)("h2",{className:"text-2xl font-semibold mb-4 text-gold text-center",children:["עסקים ב",x]}),e.length>0?(0,s.jsx)("ul",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>(0,s.jsxs)("li",{className:"bg-gray-800 p-4 rounded-lg border border-gold cursor-pointer",children:[(0,s.jsxs)("p",{className:"text-lg font-medium",children:["שכונה/איזור: ",e.neighborhood]}),(0,s.jsxs)("p",{className:"text-md text-gold",children:["מחיר: ",e.price,' ש"ח']}),(0,s.jsxs)("p",{className:"text-sm",children:["חדרים: ",e.rooms]}),(0,s.jsx)(b,{property_id:e.property_id}),(0,s.jsx)("button",{className:"mt-4 bg-gold text-black px-6 py-2 rounded-md font-semibold",onClick:()=>j(e),children:"לפרטים נוספים"}),n&&(null==r?void 0:r.property_id)===e.property_id&&(0,s.jsx)("div",{className:"relative z-50",children:i?(0,s.jsxs)("div",{className:"text-gold text-center mt-4",children:[(0,s.jsxs)("p",{className:"text-lg font-medium",children:["צור קשר עם המוכר: ",e.contact_seller]}),(0,s.jsxs)("p",{className:"text-md text-gold",children:["כתובת: ",e.address]})]}):(0,s.jsx)(u,{property_type:"business",selectedProperty:r,onClose:w})})]},e.property_id))}):x&&(0,s.jsx)("p",{className:"text-gray-400 text-center",children:"No businesses found for this city."}),g&&(0,s.jsx)("p",{className:"text-red-500 text-center",children:g})]})})},j=()=>{let[e,t]=(0,a.useState)([]),[r,l]=(0,a.useState)([]),[o,n]=(0,a.useState)(null),[c,i]=(0,a.useState)(""),[d,x]=(0,a.useState)([]),[m,h]=(0,a.useState)(null),[g,p]=(0,a.useState)(!1),[f,b]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("https://data.gov.il/api/3/action/datastore_search?resource_id=d4901968-dad3-4845-a9b0-a57d027f11ab");if(!e.ok)throw Error("Network response was not ok");let r=await e.json();if(r.success&&r.result&&r.result.records){let e=r.result.records.map(e=>e["שם_ישוב"]).filter(e=>""!==e);t(e)}else throw Error("Unexpected data format")}catch(e){e instanceof Error?b("Error fetching cities: "+e.message):b("An unknown error occurred"),console.error("Error fetching cities:",e)}})()},[]),(0,a.useEffect)(()=>{l(e.filter(e=>e.toLowerCase().includes(c.toLowerCase())))},[c,e]),(0,a.useEffect)(()=>{console.log("use effect selectedCity",o),o&&(async()=>{try{console.log("Fetching projects for city: ".concat(o));let e=await fetch("/api/projects?city=".concat(o));if(console.log("Response status: ".concat(e.status)),!e.ok){let t=await e.json();throw Error("Network response was not ok. Status: ".concat(e.status,", Details: ").concat(JSON.stringify(t)))}let t=await e.json();if(console.log("Fetched projects:",t),Array.isArray(t))x(t),console.log("Updated projects state:",t);else throw Error("Unexpected data format")}catch(e){e instanceof Error?b("Error fetching projects: "+e.message):b("An unknown error occurred"),console.error("Error fetching projects:",e)}})()},[o]);let y=e=>{console.log("Selected city before update:",o),n(e),console.log("Selected city after update:",e),i(""),console.log("Search term after update:","")},j=e=>{h(e),p(!0)};return console.log(d),(0,s.jsx)("div",{className:"bg-black text-white min-h-screen flex flex-col items-center p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-4xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6 text-gold text-center",children:"מצא את הפרויקט המתאים"}),f&&(0,s.jsxs)("div",{className:"text-red-600 mb-4 text-center",children:["Error: ",f]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"city-search",className:"block text-lg font-semibold mb-2 text-center",children:"בחר עיר:"}),(0,s.jsx)("input",{id:"city-search",type:"text",placeholder:"...הקלד שם העיר",value:c,onChange:t=>{i(t.target.value);let r=t.target.value.toLowerCase();l(e.filter(e=>e.toLowerCase().includes(r)))},className:"bg-gray-800 text-white border border-gold rounded-md px-4 py-2 w-full"}),c&&(0,s.jsx)("ul",{className:"mt-2 bg-gray-800 border border-gold rounded-md",children:r.map((e,t)=>(0,s.jsx)("li",{onClick:()=>y(e),className:"px-4 py-2 cursor-pointer hover:bg-gray-700",children:e},t))})]}),o&&(0,s.jsxs)("h2",{className:"text-2xl font-semibold mb-4 text-gold text-center",children:["פרויקטים ב",o]}),d.length>0?(0,s.jsx)("ul",{className:"space-y-4",children:d.map((e,t)=>(0,s.jsxs)("li",{className:"bg-gray-800 p-4 rounded-lg border border-gold cursor-pointer",onClick:()=>j(e),children:[(0,s.jsxs)("p",{className:"text-lg font-medium",children:["שכונה/איזור: ",e.neighborhood]}),(0,s.jsxs)("p",{className:"text-md text-gold",children:["מחיר: ",e.price,' ש"ח']}),(0,s.jsxs)("p",{className:"text-sm",children:["חדרים: ",e.rooms]})]},e.property_id))}):o&&(0,s.jsx)("p",{className:"text-gray-400 text-center",children:"No projects found for this city."}),g&&m&&(0,s.jsx)(u,{selectedProperty:m,property_type:m.property_type,onClose:()=>{console.log("Closing modal. Selected project:",m),p(!1),console.log("Modal state after closing:",g),h(null)}})]})})},w=r(1054),N=()=>{let[e,t]=(0,a.useState)(null),{setUser:r,setUserType:l,setUserId:o,setFirstListingFree:n}=(0,w.b)();return(0,a.useEffect)(()=>{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);r(t.username),l(t.userType),o(t.userId),n(t.firstListingFree),console.log("User data loaded from localStorage:",t)}else console.log("No user data found in localStorage.")},[]),(0,s.jsx)(w.R,{children:(0,s.jsxs)("div",{className:"container mx-auto p-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center",children:"מצא את הנכס או הקרקע המושלם המתאים לצרכים שלך"}),(0,s.jsx)(p,{onSelect:t}),(0,s.jsx)("div",{className:"mt-6",children:(()=>{if(!e)return null;switch(e){case"דירות":return(0,s.jsx)(g,{},"apartments");case"בתי עסק":return(0,s.jsx)(y,{},"business");case"קרקעות":return(0,s.jsx)(f,{},"land");case"פרויקט קבלן":return(0,s.jsx)(j,{},"projects");default:return null}})()})]})})}},6047:function(e,t,r){"use strict";var s=r(7437),a=r(2265);t.Z=e=>{let{onCitySelect:t}=e,[r,l]=(0,a.useState)([]),[o,n]=(0,a.useState)(""),[c,i]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),x=async()=>{try{var e;let t=await fetch("https://data.gov.il/api/3/action/datastore_search?resource_id=d4901968-dad3-4845-a9b0-a57d027f11ab");if(!t.ok)throw Error("Network response was not ok");let r=await t.json();if(r.success&&(null===(e=r.result)||void 0===e?void 0:e.records)){let e=r.result.records.map(e=>e["שם_ישוב"]).filter(e=>e);l(e)}else throw Error("Unexpected data format")}catch(e){u("Error fetching cities: ".concat(e instanceof Error?e.message:"An unknown error occurred")),console.error("Error fetching cities:",e)}};(0,a.useEffect)(()=>{x()},[]);let m=e=>{i(e),n(""),t(e)},h=r.filter(e=>e.toLowerCase().includes(o.toLowerCase()));return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"city-search",className:"block text-lg font-semibold mb-2 text-center",children:"בחר עיר:"}),(0,s.jsx)("input",{id:"city-search",type:"text",placeholder:"...הקלד שם העיר",value:o||c||"",onChange:e=>{n(e.target.value),i(null)},className:"bg-gray-800 text-white border border-gold rounded-md px-4 py-2 w-full"}),o&&(0,s.jsx)("ul",{className:"mt-2 bg-gray-800 border border-gold rounded-md max-h-48 overflow-y-auto",children:h.map((e,t)=>(0,s.jsx)("li",{onClick:()=>m(e),className:"px-4 py-2 cursor-pointer hover:bg-gray-700",children:e},t))}),d&&(0,s.jsx)("div",{className:"text-red-600 mb-4 text-center",children:d})]})}},3339:function(e,t,r){"use strict";var s=r(7437),a=r(2265);t.Z=e=>{let{onPriceChange:t,onRoomsChange:r}=e,[l,o]=(0,a.useState)(""),[n,c]=(0,a.useState)(""),[i,d]=(0,a.useState)("");return(0,a.useEffect)(()=>{l&&n&&t({min:Number(l),max:Number(n)})},[l,n,t]),(0,a.useEffect)(()=>{i&&r(Number(i))},[i,r]),(0,s.jsxs)("div",{className:"flex flex-col items-center mb-6 w-full max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"text-lg font-semibold text-center mb-2",children:"טווח מחירים:"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("input",{type:"number",value:l,onChange:e=>o(e.target.value),placeholder:"מחיר מינימלי",className:"bg-gray-800 text-white border border-gold rounded-md px-4 py-2"}),(0,s.jsx)("input",{type:"number",value:n,onChange:e=>c(e.target.value),placeholder:"מחיר מקסימלי",className:"bg-gray-800 text-white border border-gold rounded-md px-4 py-2"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"text-lg font-semibold text-center mb-2",children:"מספר חדרים:"}),(0,s.jsx)("input",{type:"number",value:i,onChange:e=>d(e.target.value),placeholder:"מספר חדרים",className:"bg-gray-800 text-white border border-gold rounded-md px-4 py-2 w-full"})]})]})}}},function(e){e.O(0,[448,342,971,117,744],function(){return e(e.s=2885)}),_N_E=e.O()}]);