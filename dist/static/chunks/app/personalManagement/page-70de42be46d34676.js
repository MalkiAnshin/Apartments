(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[368],{5473:function(e,t,r){Promise.resolve().then(r.bind(r,2014))},2014:function(e,t,r){"use strict";r.r(t);var l=r(7437),o=r(2265),s=r(9376);t.default=()=>{let[e,t]=(0,o.useState)([]),[r,a]=(0,o.useState)(!1),[n,c]=(0,o.useState)(null),[d,i]=(0,o.useState)(null),[u,p]=(0,o.useState)(null),[g,h]=(0,o.useState)({soldTo:"",soldDate:"",soldPrice:"",property_type:"apartment",contact_seller:""}),m=(0,s.useRouter)();(0,o.useEffect)(()=>{console.log("Checking for stored user in localStorage...");let e=localStorage.getItem("user"),t=e?JSON.parse(e).userId:null;t?(console.log("User found: ".concat(t)),i(t),x(t)):(console.log("User not logged in. Redirecting to login page..."),alert("משתמש לא מחובר, נא להתחבר!"),localStorage.setItem("redirectAfterLogin",window.location.pathname),m.push("/login"))},[]);let x=async e=>{console.log("Fetching properties for userId: ".concat(e)),a(!0),c(null);try{let r=await fetch("/api/personalManagement?userId=".concat(e));if(!r.ok)throw Error("לא הצלחנו לשלוף את המידע.");let l=await r.json();console.log("Fetched ".concat(l.length," properties for userId: ").concat(e,". Data:"),l),t(l)}catch(e){console.error("Error fetching properties:",e),c(e.message)}finally{a(!1)}},y=e=>{p(e),fetch("/api/personalManagement?propertyId=".concat(e),{method:"DELETE"}).then(r=>{if(!r.ok)throw Error("לא הצלחנו למחוק את הנכס.");t(t=>t.filter(t=>t.property_id!==e)),console.log("Property deleted successfully")}).catch(e=>{console.error("Error deleting property:",e),alert("שגיאה: "+e.message)})},f=e=>{p(e.property_id),h({...g,soldTo:"",soldDate:"",soldPrice:"",contact_seller:e.contact_seller||""})},b=async e=>{if(e.preventDefault(),!g.soldTo||!g.soldDate||!g.soldPrice){alert("אנא מלא את כל השדות.");return}console.log("Form data before submitting:",g);try{if(!(await fetch("/api/personalManagement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({propertyId:u,property_type:"apartment",contact_seller:g.contact_seller,userId:d,...g,sellerId:d})})).ok)throw Error("לא הצלחנו לעדכן את נתוני המכירה.");console.log("Property sale data saved successfully"),t(e=>e.filter(e=>e.property_id!==u)),p(null),h({soldTo:"",soldDate:"",soldPrice:"",property_type:"apartment",contact_seller:""})}catch(e){console.error("Error saving property sale data:",e),alert("שגיאה: "+e.message)}};return r?(console.log("Loading data..."),(0,l.jsx)("p",{className:"text-center text-lg",children:"טוען נתונים..."})):n?(console.log("Error occurred: ".concat(n)),(0,l.jsx)("p",{className:"text-center text-lg text-red-600",children:n})):(0,l.jsxs)("div",{className:"container mx-auto p-6",children:[(0,l.jsx)("h1",{className:"text-4xl font-semibold text-center text-gold mb-8",children:"ניהול נכסים"}),0===e.length?(0,l.jsx)("p",{className:"text-center text-lg text-darkGray",children:"לא נמצאו נכסים."}):(0,l.jsx)("ul",{className:"space-y-6",children:e.map(e=>(0,l.jsxs)("li",{className:"p-6 border border-gold rounded-lg shadow-xl bg-white hover:bg-gold-100 transition-all",onClick:()=>f(e),children:[(0,l.jsxs)("p",{className:"text-2xl text-gold font-semibold",children:["כתובת: ",e.address]}),(0,l.jsxs)("p",{className:"text-lg text-darkGray",children:["סוג נכס: ",e.property_type]}),(0,l.jsxs)("p",{className:"text-lg text-darkGray",children:["מחיר: ",e.price," ₪"]}),(0,l.jsx)("button",{className:"mt-4 px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all",onClick:()=>y(e.property_id),children:"מחק"})]},e.property_id))}),u&&(0,l.jsxs)("form",{onSubmit:b,className:"space-y-4 mt-8",children:[(0,l.jsx)("h2",{className:"text-xl text-center font-semibold",children:"פרטי מכירה"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"soldTo",className:"block",children:"נמכר ל:"}),(0,l.jsx)("input",{id:"soldTo",type:"text",value:g.soldTo,onChange:e=>h({...g,soldTo:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"soldDate",className:"block",children:"תאריך מכירה:"}),(0,l.jsx)("input",{id:"soldDate",type:"date",value:g.soldDate,onChange:e=>h({...g,soldDate:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"soldPrice",className:"block",children:"מחיר מכירה:"}),(0,l.jsx)("input",{id:"soldPrice",type:"number",value:g.soldPrice,onChange:e=>h({...g,soldPrice:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),(0,l.jsx)("button",{type:"submit",className:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-all",children:"שמור נתוני מכירה"})]})]})}},9376:function(e,t,r){"use strict";var l=r(5475);r.o(l,"usePathname")&&r.d(t,{usePathname:function(){return l.usePathname}}),r.o(l,"useRouter")&&r.d(t,{useRouter:function(){return l.useRouter}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5473)}),_N_E=e.O()}]);