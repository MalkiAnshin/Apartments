(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[368],{55473:function(e,r,t){Promise.resolve().then(t.bind(t,38448))},38448:function(e,r,t){"use strict";t.r(r);var o=t(57437),l=t(2265),s=t(99376);r.default=()=>{let[e,r]=(0,l.useState)([]),[t,a]=(0,l.useState)(!1),[n,d]=(0,l.useState)(null),[c,i]=(0,l.useState)(null),[u,g]=(0,l.useState)(null),[p,h]=(0,l.useState)({soldTo:"",soldDate:"",soldPrice:"",property_type:"apartment",contact_seller:""}),m=(0,s.useRouter)();(0,l.useEffect)(()=>{console.log("Checking for stored user in localStorage...");let e=localStorage.getItem("user"),r=e?JSON.parse(e).userId:null;r?(console.log("User found: ".concat(r)),i(r),x(r)):(console.log("User not logged in. Redirecting to login page..."),alert("משתמש לא מחובר, נא להתחבר!"),localStorage.setItem("redirectAfterLogin",window.location.pathname),m.push("/login"))},[]);let x=async e=>{console.log("Fetching properties for userId: ".concat(e)),a(!0),d(null);try{let t=await fetch("/api/personalManagement?userId=".concat(e));if(!t.ok)throw Error("לא הצלחנו לשלוף את המידע.");let o=await t.json();console.log("Fetched ".concat(o.length," properties for userId: ").concat(e,". Data:"),o),r(o)}catch(e){console.error("Error fetching properties:",e),d(e.message)}finally{a(!1)}},b=e=>{if(g(e),!p.soldTo||!p.soldDate||!p.soldPrice){alert("אנא מלא את כל השדות לפני מחיקת הנכס.");return}fetch("/api/personalManagement?propertyId=".concat(e),{method:"DELETE"}).then(t=>{if(!t.ok)throw Error("לא הצלחנו למחוק את הנכס.");r(r=>r.filter(r=>r.property_id!==e)),console.log("Property deleted successfully")}).catch(e=>{console.error("Error deleting property:",e),alert("שגיאה: "+e.message)})},f=e=>{g(e.property_id),h({...p,soldTo:"",soldDate:"",soldPrice:"",contact_seller:e.contact_seller||""})},y=async e=>{if(e.preventDefault(),!p.soldTo||!p.soldDate||!p.soldPrice){alert("אנא מלא את כל השדות.");return}console.log("Form data before submitting:",p);try{if(!(await fetch("/api/personalManagement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({propertyId:u,property_type:"apartment",contact_seller:p.contact_seller,userId:c,...p,sellerId:c})})).ok)throw Error("לא הצלחנו לעדכן את נתוני המכירה.");console.log("Property sale data saved successfully"),r(e=>e.filter(e=>e.property_id!==u)),g(null),h({soldTo:"",soldDate:"",soldPrice:"",property_type:"apartment",contact_seller:""})}catch(e){console.error("Error saving property sale data:",e),alert("שגיאה: "+e.message)}};return t?(console.log("Loading data..."),(0,o.jsx)("p",{className:"text-center text-lg text-gold animate-pulse",children:"טוען נתונים..."})):n?(console.log("Error occurred: ".concat(n)),(0,o.jsx)("p",{className:"text-center text-lg text-red-500 bg-red-100 p-3 rounded-lg shadow-md",children:n})):(0,o.jsxs)("div",{className:"container mx-auto p-6 bg-white/20 backdrop-blur-lg rounded-xl shadow-2xl border border-gold",children:[(0,o.jsx)("h1",{className:"text-5xl font-bold text-center text-gold mb-8 drop-shadow-lg",children:"ניהול נכסים"}),0===e.length?(0,o.jsx)("p",{className:"text-center text-lg text-darkGray",children:"לא נמצאו נכסים."}):(0,o.jsx)("ul",{className:"space-y-6",children:e.map(e=>(0,o.jsxs)("li",{className:"p-6 border border-gold rounded-xl shadow-lg bg-white/30 backdrop-blur-md hover:bg-gold/20 transition-all cursor-pointer",onClick:()=>f(e),children:[(0,o.jsxs)("p",{className:"text-2xl text-gold font-semibold",children:["כתובת: ",e.address]}),(0,o.jsxs)("p",{className:"text-lg text-gray-800",children:["סוג נכס: ",e.property_type]}),(0,o.jsxs)("p",{className:"text-lg text-gray-800",children:["מחיר: ",e.price," ₪"]}),(0,o.jsx)("button",{className:"mt-4 px-6 py-3 bg-red-500/80 text-white rounded-lg hover:bg-red-700 transition-all shadow-md",onClick:()=>b(e.property_id),children:"מחק"})]},e.property_id))}),u&&(0,o.jsxs)("form",{onSubmit:y,className:"space-y-4 mt-8 bg-white/30 backdrop-blur-md p-6 rounded-xl shadow-lg border border-gold",children:[(0,o.jsx)("h2",{className:"text-2xl text-center font-semibold text-gray-900",children:"פרטי מכירה"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"soldTo",className:"block text-gray-900",children:"נמכר ל:"}),(0,o.jsx)("input",{id:"soldTo",type:"text",value:p.soldTo,onChange:e=>h({...p,soldTo:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg bg-white/40 backdrop-blur-lg shadow-inner focus:outline-none focus:ring-2 focus:ring-gold",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"soldDate",className:"block text-gray-900",children:"תאריך מכירה:"}),(0,o.jsx)("input",{id:"soldDate",type:"date",value:p.soldDate,onChange:e=>h({...p,soldDate:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg bg-white/40 backdrop-blur-lg shadow-inner focus:outline-none focus:ring-2 focus:ring-gold",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"soldPrice",className:"block text-gray-900",children:"מחיר מכירה:"}),(0,o.jsx)("input",{id:"soldPrice",type:"number",value:p.soldPrice,onChange:e=>h({...p,soldPrice:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg bg-white/40 backdrop-blur-lg shadow-inner focus:outline-none focus:ring-2 focus:ring-gold",required:!0})]}),(0,o.jsx)("button",{type:"submit",className:"w-full bg-yellow-500 text-white py-3 rounded-lg hover:bg-yellow-800 transition-all shadow-md",children:"שמור נתוני מכירה"})]})]})}},99376:function(e,r,t){"use strict";var o=t(35475);t.o(o,"usePathname")&&t.d(r,{usePathname:function(){return o.usePathname}}),t.o(o,"useRouter")&&t.d(r,{useRouter:function(){return o.useRouter}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=55473)}),_N_E=e.O()}]);